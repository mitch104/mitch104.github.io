<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Testing complete IoT systems with hardware - Mitchell Harle</title><meta name="gridsome:hash" content="6c97515bf5b884fd3867dbeec14b8cafabb11815"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.13"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="keywords" content="Gridsome,Vue,Tailwind,Tailwind CSS,JavaScript,HTML,CSS,Vue.js,VueJS,Portfolio,Python,React Native,Software Engineer,Developer"><meta data-vue-tag="ssr" name="description" content="Peronsal website for Bristol software engineer Mitchell Harle"><meta data-vue-tag="ssr" name="author" content="Mitchell Harle"><meta data-vue-tag="ssr" data-key="description" name="description" content="Personal website for software engineer Mitchell Harle"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,700"><link rel="preload" href="/assets/css/0.styles.a059ebc5.css" as="style"><link rel="preload" href="/assets/js/app.ac1117d7.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.2d35173e.js" as="script"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.a1203547.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-vue.05634141.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.dff8ffb9.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.6a7e8012.js"><link rel="stylesheet" href="/assets/css/0.styles.a059ebc5.css"><script data-vue-tag="ssr" src="https://www.googletagmanager.com/gtag/js?id=UA-159413433-1" async></script><script data-vue-tag="ssr" src="/google-analytics.js"></script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="content-wrapper bg-background-primary font-sans text-copy-primary leading-normal flex flex-col min-h-screen"><header class="border-t-14 border-green-700"><nav class="container mx-auto flex flex-wrap justify-between items-center py-8"><div></div><div class="block lg:hidden"><button class="flex items-center px-3 py-2 border rounded border-gray-500 hover:text-gray-600 hover:border-gray-600"><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="current-color h-3 w-3"><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" fill="gray"></path></svg></button></div><ul class="uppercase tracking-wide font-bold w-full block flex-grow lg:flex lg:flex-initial lg:w-auto items-center mt-8 lg:mt-0 hidden"><li class="mr-8 mb-6 lg:mb-0"><a href="#" class="text-copy-primary hover:text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg></a></li><li class="mr-8 mb-6 lg:mb-0"><a href="/" class="text-copy-primary hover:text-gray-600">Home</a></li><li class="mr-8 mb-6 lg:mb-0"><a href="/#tools" class="text-copy-primary hover:text-gray-600">Tools</a></li><li class="mr-8 mb-6 lg:mb-0"><a href="/#projects" class="text-copy-primary hover:text-gray-600">Projects</a></li><li class="mr-8 mb-6 lg:mb-0"><a href="/#about" class="text-copy-primary hover:text-gray-600">About</a></li><li class="mr-8 mb-6 lg:mb-0"><a href="/blog" class="text-copy-primary hover:text-gray-600">Blog</a></li><li class="mr-8 mb-6 lg:mb-0"><div class="relative" data-v-94ece32a><div data-v-3ae9f24e data-v-94ece32a></div><div class="relative w-80" data-v-94ece32a><input type="text" placeholder="Search" value="" class="bg-background-form border border-gray-500 rounded-full px-4 pl-10 py-2 outline-none focus:border-green-500 w-60 md:w-80 lg:w-80" data-v-94ece32a><div class="absolute top-0 ml-3" style="top:10px" data-v-94ece32a><svg fill="currentColor" viewBox="0 0 24 24" width="24" height="24" class="text-gray-500 h-5 w-5" data-v-94ece32a><path d="M16.32 14.9l5.39 5.4a1 1 0 0 1-1.42 1.4l-5.38-5.38a8 8 0 1 1 1.41-1.41zM10 16a6 6 0 1 0 0-12 6 6 0 0 0 0 12z" class="heroicon-ui" data-v-94ece32a></path></svg></div><!----></div><!----></div></li></ul><div></div></nav></header><div class="flex-grow"><div class="container-inner mx-auto my-16"><h1 class="text-4xl font-bold leading-tight">Testing complete IoT systems with hardware</h1><div class="text-xl text-gray-600 mb-4">March 26, 2018</div><div class="flex flex-wrap mb-4 text-sm"><a href="/tag/IoT/" class="bg-gray-300 rounded-full mb-4 px-4 py-2 mr-4 hover:bg-green-300 whitespace-no-wrap">
        IoT
      </a><a href="/tag/Testing/" class="bg-gray-300 rounded-full mb-4 px-4 py-2 mr-4 hover:bg-green-300 whitespace-no-wrap">
        Testing
      </a><a href="/tag/Appium/" class="bg-gray-300 rounded-full mb-4 px-4 py-2 mr-4 hover:bg-green-300 whitespace-no-wrap">
        Appium
      </a><a href="/tag/Docker/" class="bg-gray-300 rounded-full mb-4 px-4 py-2 mr-4 hover:bg-green-300 whitespace-no-wrap">
        Docker
      </a><a href="/tag/React-Native/" class="bg-gray-300 rounded-full mb-4 px-4 py-2 mr-4 hover:bg-green-300 whitespace-no-wrap">
        React-Native
      </a></div><div class="markdown-body mb-8"><p><em>This <a href="https://zoetrope.io/tech-blog/end-to-end-iot-hardware-appium-testing/" target="_blank" rel="nofollow noopener noreferrer">article</a> was written during my time at <a href="https://zoetrope.io/" target="_blank" rel="nofollow noopener noreferrer">Zoetrope Labs</a>.</em></p>
<p>Zoetrope labs has been involved in many IoT projects which lead to hardware ending up in end users homes and businesses. This poses a great challenge in that all hardware and software must not only work, but be resilient enough to deal with a wide range of customers usage patterns. Combined with the demand for speedy delivery of new features and the challenge only compounds.</p>
<p>With this in mind, Zoetrope labs has had a complete hardware-in-loop testing setup for some of the major projects we’ve been working on which allows all aspects of the software to be tested on real hardware. This helps us capture bugs which otherwise could easily be missed, especially those which are dependent on user input, or interaction with components outside of the system’s control.</p>
<p><em>Note: By “hardware-in-loop” testing, we mean that the real units - e.g. IoT devices, wifi, phones etc are all used as parts of the tests. This is often called “<a href="https://en.wikipedia.org/wiki/System_testing" target="_blank" rel="nofollow noopener noreferrer">System testing</a>”, however we don’t feel this quite captures how many different components are involved when applying this process to IoT systems.</em></p>
<p>The test suite we created for one recent project was a major task and we’re going to outline it in this post.</p>
<h2 id="the-system-under-test"><a href="#the-system-under-test" aria-hidden="true"><span class="icon icon-link"></span></a>The system under test</h2>
<p>For this system, the main I/O from the end device is IR (which interacts with legacy appliances). This includes both receiving IR data (training data) and sending that data on command. This I/O could easily be anything else, such as switches, PLC’s or more complex and stateful hardware device such as doors, factory machinery etc. Aside from the IR interface, the system design is very standard:</p>
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 818 714' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-e45323c8f937a2ec378c34d1d82a0c64'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-e45323c8f937a2ec378c34d1d82a0c64)' width='818' height='714' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAA4CAIAAADCemklAAAACXBIWXMAAAsSAAALEgHS3X78AAANIklEQVRo3s1aaWwbxxVmbcVF29RJE6Ru4iZpU6eNY6dOWuc0mqRAgR5I%2byc90BYt4CIp%2biNofgQN0Ba9UgRoEidxHB9SbPmSLEuyZEnWfYsiRVGWKFK3JdESRYnn8lqSy5urfjMjrimKpGlLNLJ4GM3ODnfnzXvzve/NSLacdIm5SaZrnT%2b/uUt27fNiri9P2zMuijm%2bIU67iRuvwPKyJxp2RELObBL0xyJZRhbLKuF4XIhFN94CIp2OEa9D7bGOeV0jXqfO61graL/ssTdxC1cFngx3WWQuEaMzig77%2bmv29lU93X/xqf5qIqrqp1WkZJW9qqoXBup%2bN9rZbF9Af0ck6KIzwio3JJjKmBhPVoBccpc5mmjNNMH4sdbLqdwWyRNwsV8dnB%2bR1RwoaDwsqz8kq/9oRS4dZJVNaKw98LSycoi3/3VazRSIimIkHmdTEM9N2GR5YxFmSTFZAZXbGqWP0ckeDphCwrzghVNBXUc4aA4JeITvmUL%2bTufSZY/NGQ26oyFPNGQLC2Ne59tXNbKGjwtaCh/oKbmn8/T93SV3dZx8oLvk7o5TELTc2XFya/uJO9tP/mlcjlfx0bBe8HQ6lgY99ljuy4%2bW/rQK9LktkgIDHvuQx97jNDVzRpRtjkUtz7FX%2bKKREtP0f/UamIL6FRzPdmBO9/qkEgrImo89qaqCL72kadrZW/6SpvnFgbofDjY8p67Zp67d0lIEO7w61sMsEIzHtF4HJm4u4F0I%2bAwB73zAa0Al6GOVOdoiCW5nBd4bDWP0aRRQui0pM8GMK1InkRyGCwfhBmtd6AO40KWDm1sKMcqClqLbWotQLyB1lIVbWotuayGCPvtHu5gFoP%2bEz7UU9M8KHtgB9Sm/G8bU8Y4rfve4zzXj96CFybTffTXA6wN8l3PJt8YCZCgKl9kY9LmiIS4SJBIOwnOY/xAhjQF8Fe/FB5YTWsWJH8dwW2W5Kms6hiFi3JtbVkb/hbbjt1F9NjcTNT7b%2boms8fD/rg4zP4bNvdEVTMOIYeppvwcmxVQOeTjcjnodwzw34LFBPQv1YVy9LjMcO7DWAmjSeTltVtHw9km/K54hDsDrup0mgAETfOlv0%2bom%2bwIG1ENbelymfrcVCwnKYxaxzNAfTxUuCy3NksidJvwcOjCRu0g3CCpAwkCKC%2bXpwtv/OXMZ1pOMLF2heCwcj2EojykrnqQIu0dZ%2bXhf5beVlXuofLfvAmlBRVX1RN%2bF79BbdPtmb9kbUypMlo%2bGo1QFcsSyLDi7qpsoangOi54MPwEPbJlh%2beJPqWlaVv3O7U1Hv9ZT%2bmBP6UM95x7pPY8KbnfIz93RduIh%2bTmM/r6uM/d2nHpUUbG964ys%2bt1nes/jt%2bkVWP%2bUp3AerEtma3zPSUyxAgnwARgBHvuDy/XAq1/r2n%2bhbfvtSMfvRztR%2bTlkGGXrr3Sk8eXh1peHW36ja/%2bltg2Y9h/9YCyTBdY1%2bnSWATRx1IXckVC7YxHLoIUzYlXwFAoRhk8uTRUaJ44ZJ4qME0cWxo8Zx3H7yeJkEcQ4KT1CiXrx4tT78zqsDVASfz4sEIxHPZEQBifJW/oh4DfGijqiOFBu0ucKxmLoiW%2bXm2dkDYe2d5%2b9s70Y4Lut6/SXOoq3dZ7B7UPysq/3lG5tO35He/EX20/c3Xnq9paiLQ0fH10Y//OEIhVG13kxt8bs3td19t6uMyiJ15LKmQd7Sljj9q6zGMT31LWl5pk6m4GhcJ1t/nOtx7FedysqdsjLsFIfVZRjsWIZ7FFW7FKUY8nuVJRjPSA4ohGgDBry2qTixlBIZLwN63JZlAicmAQsLJB9iEBW92FB01EgPZUjpERsprebcFt/cHfveXjCG1N96G8PBwHnoBJwqlbOiGAPkocKbuFsrdwiaSSPFttI4wIagbkVZv2o1wlg2BgXAqLbwoGFoK/BbgBigrR9pesMWBCmDZUdvWWYPEAKTAE/gdzVXiy7%2bO4rY900ogcQy8IiiQkRKtGEJNelW9YH1A8I5k5ho9kvBEtrSACcIzxjuH5qPvg0XodQj3nS8VypaebNK/1QAFC4T13DFPjxUCNA5tn%2bmp8MNcJ5fqZpBq7L6j74IyVzkazM92YSmkzUD2Trks0AVid3mmtt8yhBReG%2bIAKgk3MBXgIc8Bzwhc80H5M1HSUlrUgCTvH51uNws/0jneiPuRdzzkKz5KXXt0AiAxSTWTubP0KwhBUFoKHE2FIECINHBbQCTQ4vjElLP78WWBOhrn2TaQUXAsVdXnkkglSO8A7QyUwCcgZeGd0g57kBBTKZZZUCOW8KxEXx06dAEtW5ruRtWyVnMiemU4CRnFxEzJMC67SAuJx7XrvRLiQmODp4C%2bgKZCEhyFNZxZgkMTKLqWsAKs36PVipSNkyyZjPNelzI/zlZV%2boz2VFkoqkDjkX8FEv8LMU5lHBQKcF96TfPSN4kFKhm5QH6hMwisggaz4KWYkApJ5SHtuEsuHQu3NaiYBspAWQ17GXoqy3G0bpjgNySHB6xDKolJLU44KG89QCuEB0SSBrLiTkh0QuRLEjq3hR4%2bECKJAIZJENV0BFs1WRLtMJnxO8F/MN5gTkRh2%2bxPweJKLENP3OnBajB7PvcCzBMqDsf7miktUf%2bnLnaaSFTygvgAyDQezsLX%2bu/%2bJuZcXD8rJdioptnaehwKvjPXlUgI3SGg6M%2bZy2UMASEuDloEDSzgqI1CXbPMiFOSwgSVe5LVgVyLsZmbur4yS4EAjc1vbib/Wef2Gg7ilV9Z6%2bSjQ%2brrzw1e6zsksfvjKWHwVA6CWKBwXGfWQnVOkiGwGjPqe0VECDwYVYt5kkFyJcqO4DQqcTFJpU6g%2bRkgipFMCpat/PhwuRkSEBx3RqeccQz6HU0T0ZuJDWy6ECIe1eByZ7VuDFxCKWuBAMiJwDTgLafO9KZkOSm%2b00v0GJdtze03m6wqLPCxeCk8A9kGR4aPqHrAeY%2bPeZAaQObtooCQPNtZE4EI96Y2Hke5mEbMrSZDJfkTgl1piCfqzOtYcRaRW4gUB2C7gQ%2bwIAB/iT9jQlrQVuegNG3CgFUrbh4UgaCvmxNRtb6yFzYm77YlmYWA4WoN3mBe%2bbV9QbawHJtuaQAEFYBFLzkfBNn5rJkl9KYYcEYEAQYFThMhcaJ1Bh5wAjiUchuh29mgsRDEBQq7HO19kMaQWho8o6d848I8QiGDSoRw3NS9UeG1JTto1Hv%2btiH0IgwmBGkz4NUIFHICgla3sNRntdZmPAh8fWUMAeDqCC6QEu4WNMzCE/WhCkhxOHHVBAglHk9UD9TYw4rJCIIxKJ2ISW%2bo92yc%2bfWrpyYE5HcuJ4TEpWUYLk4bX4Ll6I0hkJLgX9EEtYQFCy08FgDNaQ0OlYSgaMVSc0EjYznFl73sFOViQFQJCkpP6gYQTRCmk78npwoU3NhSy1Z6cbmwmN%2b/jh3rJ/zAy%2bPqVMJnNMDUy/KeQne/S8HXFTQ8OOjtpB5bKOkfNF2ww1VMpBTDKVsOD3sEODzdDlNCEGgwUhPKndVtixlTP2uSyLQT/igCZB5gwBXxu3CH76tl7z2qQCcwyy8Ly69pn%2biz8abHxEcf45dc33B%2br2KCtfHKjbq6r%2bRneprPqdnw41vqUfauYWhnk7Xq7luX/PDiKQOxK7qJgUjNVBg5I3GpkTeLAVWMNKzzgwpPQK9NNDPi4SxO%2bBnoCgUDw%2bL5A6HH3E64QXummMY%2bdlbOawHtCyEPC9N6eFC23rOv1Ib/ljyorH%2bwife0xZCQ53f3cJFHh%2boHaHvAxK7h/rRoIBFw3GYoiSiJiI6Fhv8JDYsthDmQtmE1OOQWPomEd8GskGpi%2bbAslcKAuAcIQLpTkj%2b8gwKqs9sJnwn6QD1sQxK6sU4GnNe3%2bgZ2SR1S4EI0MrVMBc4JnwHHiUgUycY5C3t3BGtdtmpB3kTlPyOK8tYgo74EJwPjsVTpNUx1sgeAoutERnImWLBWkQ457P9l%2bEC7Fyr6rqGdVKnQk6YBUmcyH2xxkJdTtMw9TvtfRQndIwesbOIy3h2PE7pn%2bQTp%2bYNg7AmmAs/syCp%2bEEhuYC%2bW9e6U%2bg3vVRHiqx89Nk8a%2b%2bDa75%2bkb%2bswcNk6ukeHGKHXDEl%2bOsJb6c8ZAKToXxhbIKOqRgoyx//26DC67MNvLjmX/OWoAEWIQDHpvaY4WgslawrIGhGgoh4jq3VXK8sH6kk4jsOzRQ1ZDY4MiOIilgky8FxMShtD7AA5otCPCZBVGs22laDPqA9MAS4Cm8hW7rB1B66GkV29NHCepx6xRASBny2JP5TIroeA5x5l8zl4HCGDf8pNKiZ1jUYDdctM5hvhEWAH3I42pt87OCBy%2bM3gIFbnSTD0ZYpDAfSzBzxmXY/59gxJh%2b1rNvLZXI6%2bCuK1G6UYdgDFoBDsdoNqWPAcbe2K2dOhtCULtjcQP2RjdeVXq8MO4l%2b1GQiUQ54Xclt6AD2OStQ6FbcH2KFGDpYnaJL6dGwf8Ds6ZalVUuu7cAAAAASUVORK5CYII=' /%3e%3c/svg%3e" width="818" alt="System diagram" data-srcset="/assets/static/iot-testing.82a2fbd.101f743b8a410c5a65e1a292c125624b.png 480w, /assets/static/iot-testing.bda9032.101f743b8a410c5a65e1a292c125624b.png 818w" data-sizes="(max-width: 818px) 100vw, 818px" data-src="/assets/static/iot-testing.bda9032.101f743b8a410c5a65e1a292c125624b.png"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/iot-testing.bda9032.101f743b8a410c5a65e1a292c125624b.png" width="818" alt="System diagram"></noscript></p>
<h2 id="as-a-user-i-should-be-able-to"><a href="#as-a-user-i-should-be-able-to" aria-hidden="true"><span class="icon icon-link"></span></a>As a user, I should be able to…</h2>
<p>The main function of the e2e testing is to ensure that the system is able to perform the actions that are required of it. Some examples of the kinds of test cases which were created are:</p>
<ol>
<li>Creating a user account</li>
<li>Performing Wifi on-boarding of the IoT gateway</li>
<li>Thread on-boarding using QR scanning</li>
<li>Training the IR sensor with real IR input</li>
<li>Checking that the IoT device sends data when requested</li>
<li>Setting up schedules and other app functionality</li>
</ol>
<h2 id="appium-pytest-and-a-whole-bunch-of-usb-serial-adapters"><a href="#appium-pytest-and-a-whole-bunch-of-usb-serial-adapters" aria-hidden="true"><span class="icon icon-link"></span></a>Appium, PyTest and a whole bunch of USB serial adapters</h2>
<p>Due to the need to be able to factory reset hardware during and at the end of the tests we had 2 options - simulate button presses with relays or some other switching method soldered on to the target boards, or we could use builds of the software which had serial enabled (Shipped versions never have serial enabled!). We opted for using serial cables because this allowed us to accelerate the testing by being able to send <code>reset</code> commands to the target hardware and verify that this had happen. In other parts of the tests, serial output is used to assert correct output from system components to help debug when a larger component fails.</p>
<p>In an ideal world we of course would not have needed serial cables and we would have a mechanical means to physically actuate any user input. That’s not likely to happen for us soon due to the large time investment in making custom rigs for every device which we test.</p>
<p>The main system testing stack was built with:</p>
<ol>
<li>Appium (1.6.5)</li>
<li>PyTest (with extensive use of fixtures for code reuse)</li>
<li>Pyserial</li>
<li>Docker (for running in CI)</li>
</ol>
<h2 id="appium"><a href="#appium" aria-hidden="true"><span class="icon icon-link"></span></a>Appium</h2>
<p>“<a href="http://appium.io/docs/en/about-appium/intro/?lang=en" target="_blank" rel="nofollow noopener noreferrer">Appium is an open-source tool for automating native, mobile web, and hybrid applications on iOS, Android and Windows platforms</a>”. Appium is cross-platform so the same test code can be applied to both the iOS and Android versions of the React-Native app which itself uses the same JavaScript code for both (mostly!).</p>
<p>Appium abstracts the vendor-provided automation frameworks including Apple’s XCTest, Google’s UiAutomator, Google’s Instrumentation and Microsoft’s WinAppDriver are wrapped in a single API, known as the “WebDriver”, which is the same API used in Selenium, a popular tool for automated website testing.</p>
<p>Appium uses a Client/Server model, connected via the WebDriver API, where the client sends appropriate HTTP requests to the server in order to execute commands on the target device. The server will respond with the result of the command execution. This abstraction means that the client and tests can be written in any language with a HTTP client, clients are already available in many languages such as Python, Java, Perl, PHP and Ruby. We chose to use the <a href="https://github.com/appium/python-client" target="_blank" rel="nofollow noopener noreferrer">Python client</a>, matching the language of the IoT platform software. This has the added benefit that existing code such as PyTest fixtures can be implemented easily.</p>
<h2 id="writing-tests"><a href="#writing-tests" aria-hidden="true"><span class="icon icon-link"></span></a>Writing tests</h2>
<p>We based our test code around this <a href="https://github.com/casschin/appium-pytest" target="_blank" rel="nofollow noopener noreferrer">Appium example project</a>, which uses the Python Appium client in combination with PyTest. The code consists of a <code>screen.py</code> file which contains useful helper functions such as <code>get_elements_by_type</code> which, when given a method of element identification (<code>xpath</code>, <code>accessibility_id</code>, <code>id</code>, <code>class_name</code>, <code>name</code>, <code>android</code> or <code>ios</code>) and corresponding value, returns the element you wish to interact with. A very helpful tool for identifying characteristics of the currently rendered DOM and it’s elements for Android is <code>UiAutomatorView</code> which comes with Android Studio. Each screen within the app has a Python class associated with it where all of the relevant element locators are defined, usually just the elements that a user can interact with e.g. buttons, scroll windows and text fields.</p>
<p>Appium commands are built up in to a sequence of functions acting across multiple screens of the target app with one or more assert statement that tests whether the app has behaved as expected. The assert statement can be as simple as asserting that an element is visible on the screen or that the text within the elements is equal to an expected value. A simple example test is registering a new user and ensuring that you can login to the app using the newly registered account.</p>
<p>Our longest and most complex test includes the whole user experience setting up the IoT system after unboxing and testing all of the major bits of product functionality. The setup process even involves scanning a QR code to identify the IoT Device to setup, therefore the camera on the Mobile Device is directed towards a print out of the relevant QR code. One piece of tested functionality is the ability to schedule times at which the AC power is turned on / off with a defined configuration, for example every Monday at 12:30pm turn on the AC at 16°C, on <code>Cool</code> mode with fan setting <code>High</code>, then turn off at 4:15pm. To test this an IR event is scheduled 2 minutes into the future from the time at which the new schedule is saved. The test then waits long enough to check if that action gets performed as expected. The IR Receiver is then sent a command to collect any IR data that it receives over a 5 second period. If the system is functioning correctly in all areas then the IoT Device should emit IR data at that time. An assert statement then checks whether the IR data received is correct, meaning that it would result in an real AC device being turned on with the desired configuration.</p>
<h2 id="challenges"><a href="#challenges" aria-hidden="true"><span class="icon icon-link"></span></a>Challenges</h2>
<h3 id="test-repeatability"><a href="#test-repeatability" aria-hidden="true"><span class="icon icon-link"></span></a>Test repeatability</h3>
<p>Naturally, an essential property of any test is repeatability, this is being able to run the same test multiple times on the same system and having the same outcome. To achieve this it was ensured that the state of the whole system was the same at the start and end of each class of PyTest tests. When the IoT Gateway and Devices are connected during the setup process this leaves them in a state in which another user of the mobile application cannot communicate with them. Resetting the IoT hardware to factory settings was done using a serial cable connected to the test machine or over SSH, this happens within the teardown phase of PyTest fixtures which can be applied to any test that requires it. The state of the database is also manipulated using fixtures, for example populating the database in the setup phase with relevant sensor data to be shown on the app graphs or reverting changes in the tear-down phase such as deleting a new user that was registered during the test.</p>
<h3 id="time"><a href="#time" aria-hidden="true"><span class="icon icon-link"></span></a>Time</h3>
<p>Appium tests are usually faster than it would take to perform the tests manually however if many tests are created, to give a high level of coverage, then the execution time of a full test run can reach into the hours. This means that a test run on every new commit is not practical, so instead tests are run overnight, this can sometimes hinder development flow. The time spent during test execution includes the time it takes to perform actions, particularly sending keys into text fields, and waiting for the app to render the element that Appium is waiting for which increases with the response time of the Database Server.</p>
<h3 id="platform-specifics"><a href="#platform-specifics" aria-hidden="true"><span class="icon icon-link"></span></a>Platform specifics</h3>
<p>Despite using React-Native in this case, there are many platform specific differences between iOS and android, for example in our React-Native app we use the native time pickers which have a very different appearance on the two platforms. This means that separate test code has to be used when interacting with these components. The Android time picker also happened to be very tricky to interact with via Appium as the movable minute hand of clock snaps to the nearest 5 minutes if the clock is tapped. A work around was to scroll from the nearest 5th minute to the desired minute, which rotates the minute hand during the scroll and stops without snapping.</p>
<p>Unfortunately, there are a great many other examples of these differences.</p>
<h3 id="react-native"><a href="#react-native" aria-hidden="true"><span class="icon icon-link"></span></a>React-Native</h3>
<p>Facebook, who developed React-Native, use the <code>testId</code> property of the rendered views in their internal testing however this is not available in the current version of Appium (v1.6.5). The <code>reasourceId</code> can also not be set via React-Native (v49.0). Hence at the moment a work around for uniquely identifying elements is to use the <code>accessibilityLabel</code> which sets the <code>content-desc</code> property of the view. The disadvantage of using the <code>content-desc</code> property is that this is displayed to the user if they chose to do so from the accessibility settings, so the <code>content-desc</code> needs to be human readable and unique at least within each screen. At the time of putting together the E2E test system no accessibility labels were set in the app, so there was the tedious task of defining all of these for every element that was to be used in testing.</p>
<h3 id="brittleness"><a href="#brittleness" aria-hidden="true"><span class="icon icon-link"></span></a>Brittleness</h3>
<p>Due to the fact that so many parts of the system are touched in every test, changes in any one of those components has the ability to break the tests, or require that more are created. Fixtures have helped us to mitigate many of the problems of this, since generally updating a fixture and a couple of tests is all that’s required.</p>
<h2 id="conclusion"><a href="#conclusion" aria-hidden="true"><span class="icon icon-link"></span></a>Conclusion</h2>
<p>E2E testing complete IoT systems has identified compatibility issues and bugs before releases that our unit tests did not catch, particularly between the app and the server where the software is changing most rapidly. More importantly we have been able to ensure that all app functionality is tested very regularly, rather than the risk that only new or changed features are tested (rather than their knock-on effects).</p>
<p>Appium served as a very helpful, easy to use testing tool for automating user interaction with the IoT system, already saving precious days of manual testing time. The essentials of this test system should be able to port over to other similar IoT projects which use an Android or iOS app as it’s main user interface.</p>
</div><div class="mb-8"><a href="/blog" class="font-bold uppercase">Back to Blog</a></div></div></div><footer class="bg-green-700 text-white"><div class="container mx-auto flex flex-col lg:flex-row items-center justify-between py-8"><div class="mb-8 lg:mb-0"></div><ul class="flex items-center"><li class="mr-8"><a href="mailto:mitch_10_4@hotmail.com" class="text-white hover:text-gray-400"><svg width="25" height="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 0h20A2.5 2.5 0 0 1 25 2.5v15a2.5 2.5 0 0 1-2.5 2.5h-20A2.5 2.5 0 0 1 0 17.5v-15C0 1.125 1.125 0 2.5 0zm20 4.225V2.5h-20v1.725l10 5 10-5zm0 2.8l-9.438 4.713a1.25 1.25 0 0 1-1.124 0L2.5 7.025V17.5h20V7.025z" fill-rule="nonzero"></path></svg></a></li><li class="mr-8"><a href="https://github.com/mitch104" target="_blank" class="text-white hover:text-gray-400"><svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></li><li><a href="https://www.linkedin.com/in/mitchellharle/?originalSubdomain=uk" target="_blank" class="text-white hover:text-gray-400"><svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg></a></li></ul></div></footer><div style="display:none"><svg id="dots-triangle" width="170" height="170" xmlns="http://www.w3.org/2000/svg"><path d="M168.152 170a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm-18.478-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0 18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm-18.478 0a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.479a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm-18.479 0a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0 18.479a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0 18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-55.435a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zM94.24 133.043a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0 18.479a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0 18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-55.435a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm-18.478 36.956a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0 18.479a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0 18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-55.435a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm-18.478 55.434a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0 18.479a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0 18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-55.435a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.479a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm-18.479 73.913a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0 18.479a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0 18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-55.435a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.479a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm-18.478 92.391a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0 18.479a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0 18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-55.435a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.479a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zM1.848 133.044a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.695zm0 18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0 18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-55.435a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.479a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.695 1.848 1.848 0 0 1 0 3.695zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696zm0-18.478a1.848 1.848 0 1 1 0-3.696 1.848 1.848 0 0 1 0 3.696z" fill="#2C8056" fill-rule="evenodd" opacity=".503"></path></svg></div></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"Testing complete IoT systems with hardware","date":"March 26, 2018","content":"\u003Cp\u003E\u003Cem\u003EThis \u003Ca href=\"https:\u002F\u002Fzoetrope.io\u002Ftech-blog\u002Fend-to-end-iot-hardware-appium-testing\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Earticle\u003C\u002Fa\u003E was written during my time at \u003Ca href=\"https:\u002F\u002Fzoetrope.io\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EZoetrope Labs\u003C\u002Fa\u003E.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EZoetrope labs has been involved in many IoT projects which lead to hardware ending up in end users homes and businesses. This poses a great challenge in that all hardware and software must not only work, but be resilient enough to deal with a wide range of customers usage patterns. Combined with the demand for speedy delivery of new features and the challenge only compounds.\u003C\u002Fp\u003E\n\u003Cp\u003EWith this in mind, Zoetrope labs has had a complete hardware-in-loop testing setup for some of the major projects we’ve been working on which allows all aspects of the software to be tested on real hardware. This helps us capture bugs which otherwise could easily be missed, especially those which are dependent on user input, or interaction with components outside of the system’s control.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cem\u003ENote: By “hardware-in-loop” testing, we mean that the real units - e.g. IoT devices, wifi, phones etc are all used as parts of the tests. This is often called “\u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FSystem_testing\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ESystem testing\u003C\u002Fa\u003E”, however we don’t feel this quite captures how many different components are involved when applying this process to IoT systems.\u003C\u002Fem\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EThe test suite we created for one recent project was a major task and we’re going to outline it in this post.\u003C\u002Fp\u003E\n\u003Ch2 id=\"the-system-under-test\"\u003E\u003Ca href=\"#the-system-under-test\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EThe system under test\u003C\u002Fh2\u003E\n\u003Cp\u003EFor this system, the main I\u002FO from the end device is IR (which interacts with legacy appliances). This includes both receiving IR data (training data) and sending that data on command. This I\u002FO could easily be anything else, such as switches, PLC’s or more complex and stateful hardware device such as doors, factory machinery etc. Aside from the IR interface, the system design is very standard:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg class=\"g-image g-image--lazy g-image--loading\" src=\"data:image\u002Fsvg+xml,%3csvg fill='none' viewBox='0 0 818 714' xmlns='http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg' xmlns:xlink='http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-e45323c8f937a2ec378c34d1d82a0c64'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'\u002F%3e%3c\u002Ffilter%3e%3c\u002Fdefs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-e45323c8f937a2ec378c34d1d82a0c64)' width='818' height='714' xlink:href='data:image\u002Fpng%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAA4CAIAAADCemklAAAACXBIWXMAAAsSAAALEgHS3X78AAANIklEQVRo3s1aaWwbxxVmbcVF29RJE6Ru4iZpU6eNY6dOWuc0mqRAgR5I%2byc90BYt4CIp%2biNofgQN0Ba9UgRoEidxHB9SbPmSLEuyZEnWfYsiRVGWKFK3JdESRYnn8lqSy5urfjMjrimKpGlLNLJ4GM3ODnfnzXvzve\u002FNSLacdIm5SaZrnT%2b\u002FuUt27fNiri9P2zMuijm%2bIU67iRuvwPKyJxp2RELObBL0xyJZRhbLKuF4XIhFN94CIp2OEa9D7bGOeV0jXqfO61graL\u002FssTdxC1cFngx3WWQuEaMzig77%2bmv29lU93X\u002Fxqf5qIqrqp1WkZJW9qqoXBup%2bN9rZbF9Af0ck6KIzwio3JJjKmBhPVoBccpc5mmjNNMH4sdbLqdwWyRNwsV8dnB%2bR1RwoaDwsqz8kq\u002F9oRS4dZJVNaKw98LSycoi3\u002F3VazRSIimIkHmdTEM9N2GR5YxFmSTFZAZXbGqWP0ckeDphCwrzghVNBXUc4aA4JeITvmUL%2bTufSZY\u002FNGQ26oyFPNGQLC2Ne59tXNbKGjwtaCh\u002FoKbmn8\u002FT93SV3dZx8oLvk7o5TELTc2XFya\u002FuJO9tP\u002Fmlcjlfx0bBe8HQ6lgY99ljuy4%2bW\u002FrQK9LktkgIDHvuQx97jNDVzRpRtjkUtz7FX%2bKKREtP0f\u002FUamIL6FRzPdmBO9\u002FqkEgrImo89qaqCL72kadrZW\u002F6SpvnFgbofDjY8p67Zp67d0lIEO7w61sMsEIzHtF4HJm4u4F0I%2bAwB73zAa0Al6GOVOdoiCW5nBd4bDWP0aRRQui0pM8GMK1InkRyGCwfhBmtd6AO40KWDm1sKMcqClqLbWotQLyB1lIVbWotuayGCPvtHu5gFoP%2bEz7UU9M8KHtgB9Sm\u002FG8bU8Y4rfve4zzXj96CFybTffTXA6wN8l3PJt8YCZCgKl9kY9LmiIS4SJBIOwnOY\u002FxAhjQF8Fe\u002FFB5YTWsWJH8dwW2W5Kms6hiFi3JtbVkb\u002Fhbbjt1F9NjcTNT7b%2boms8fD\u002Frg4zP4bNvdEVTMOIYeppvwcmxVQOeTjcjnodwzw34LFBPQv1YVy9LjMcO7DWAmjSeTltVtHw9km\u002FK54hDsDrup0mgAETfOlv0%2bom%2bwIG1ENbelymfrcVCwnKYxaxzNAfTxUuCy3NksidJvwcOjCRu0g3CCpAwkCKC%2bXpwtv\u002FOXMZ1pOMLF2heCwcj2EojykrnqQIu0dZ%2bXhf5beVlXuofLfvAmlBRVX1RN%2bF79BbdPtmb9kbUypMlo%2bGo1QFcsSyLDi7qpsoangOi54MPwEPbJlh%2beJPqWlaVv3O7U1Hv9ZT%2bmBP6UM95x7pPY8KbnfIz93RduIh%2bTmM\u002Fr6uM\u002Fd2nHpUUbG964ys%2bt1nes\u002Fjt%2bkVWP%2bUp3AerEtma3zPSUyxAgnwARgBHvuDy\u002FXAq1\u002Fr2n%2bhbfvtSMfvRztR%2bTlkGGXrr3Sk8eXh1peHW36ja\u002F%2bltg2Y9h\u002F9YCyTBdY1%2bnSWATRx1IXckVC7YxHLoIUzYlXwFAoRhk8uTRUaJ44ZJ4qME0cWxo8Zx3H7yeJkEcQ4KT1CiXrx4tT78zqsDVASfz4sEIxHPZEQBifJW\u002Foh4DfGijqiOFBu0ucKxmLoiW%2bXm2dkDYe2d5%2b9s70Y4Lut6\u002FSXOoq3dZ7B7UPysq\u002F3lG5tO35He\u002FEX20\u002Fc3Xnq9paiLQ0fH10Y\u002F\u002FOEIhVG13kxt8bs3td19t6uMyiJ15LKmQd7Sljj9q6zGMT31LWl5pk6m4GhcJ1t\u002FnOtx7FedysqdsjLsFIfVZRjsWIZ7FFW7FKUY8nuVJRjPSA4ohGgDBry2qTixlBIZLwN63JZlAicmAQsLJB9iEBW92FB01EgPZUjpERsprebcFt\u002FcHfveXjCG1N96G8PBwHnoBJwqlbOiGAPkocKbuFsrdwiaSSPFttI4wIagbkVZv2o1wlg2BgXAqLbwoGFoK\u002FBbgBigrR9pesMWBCmDZUdvWWYPEAKTAE\u002FgdzVXiy7%2bO4rY900ogcQy8IiiQkRKtGEJNelW9YH1A8I5k5ho9kvBEtrSACcIzxjuH5qPvg0XodQj3nS8VypaebNK\u002F1QAFC4T13DFPjxUCNA5tn%2bmp8MNcJ5fqZpBq7L6j74IyVzkazM92YSmkzUD2Trks0AVid3mmtt8yhBReG%2bIAKgk3MBXgIc8Bzwhc80H5M1HSUlrUgCTvH51uNws\u002F0jneiPuRdzzkKz5KXXt0AiAxSTWTubP0KwhBUFoKHE2FIECINHBbQCTQ4vjElLP78WWBOhrn2TaQUXAsVdXnkkglSO8A7QyUwCcgZeGd0g57kBBTKZZZUCOW8KxEXx06dAEtW5ruRtWyVnMiemU4CRnFxEzJMC67SAuJx7XrvRLiQmODp4C%2bgKZCEhyFNZxZgkMTKLqWsAKs36PVipSNkyyZjPNelzI\u002FzlZV%2boz2VFkoqkDjkX8FEv8LMU5lHBQKcF96TfPSN4kFKhm5QH6hMwisggaz4KWYkApJ5SHtuEsuHQu3NaiYBspAWQ17GXoqy3G0bpjgNySHB6xDKolJLU44KG89QCuEB0SSBrLiTkh0QuRLEjq3hR4%2bECKJAIZJENV0BFs1WRLtMJnxO8F\u002FMN5gTkRh2%2bxPweJKLENP3OnBajB7PvcCzBMqDsf7miktUf%2bnLnaaSFTygvgAyDQezsLX%2bu\u002F%2bJuZcXD8rJdioptnaehwKvjPXlUgI3SGg6M%2bZy2UMASEuDloEDSzgqI1CXbPMiFOSwgSVe5LVgVyLsZmbur4yS4EAjc1vbib\u002FWef2Gg7ilV9Z6%2bSjQ%2brrzw1e6zsksfvjKWHwVA6CWKBwXGfWQnVOkiGwGjPqe0VECDwYVYt5kkFyJcqO4DQqcTFJpU6g%2bRkgipFMCpat\u002FPhwuRkSEBx3RqeccQz6HU0T0ZuJDWy6ECIe1eByZ7VuDFxCKWuBAMiJwDTgLafO9KZkOSm%2b00v0GJdtze03m6wqLPCxeCk8A9kGR4aPqHrAeY%2bPeZAaQObtooCQPNtZE4EI96Y2Hke5mEbMrSZDJfkTgl1piCfqzOtYcRaRW4gUB2C7gQ%2bwIAB\u002FiT9jQlrQVuegNG3CgFUrbh4UgaCvmxNRtb6yFzYm77YlmYWA4WoN3mBe%2bbV9QbawHJtuaQAEFYBFLzkfBNn5rJkl9KYYcEYEAQYFThMhcaJ1Bh5wAjiUchuh29mgsRDEBQq7HO19kMaQWho8o6d848I8QiGDSoRw3NS9UeG1JTto1Hv%2btiH0IgwmBGkz4NUIFHICgla3sNRntdZmPAh8fWUMAeDqCC6QEu4WNMzCE\u002FWhCkhxOHHVBAglHk9UD9TYw4rJCIIxKJ2ISW%2bo92yc%2bfWrpyYE5HcuJ4TEpWUYLk4bX4Ll6I0hkJLgX9EEtYQFCy08FgDNaQ0OlYSgaMVSc0EjYznFl73sFOViQFQJCkpP6gYQTRCmk78npwoU3NhSy1Z6cbmwmN%2b\u002Fjh3rJ\u002FzAy%2bPqVMJnNMDUy\u002FKeQne\u002FS8HXFTQ8OOjtpB5bKOkfNF2ww1VMpBTDKVsOD3sEODzdDlNCEGgwUhPKndVtixlTP2uSyLQT\u002FigCZB5gwBXxu3CH76tl7z2qQCcwyy8Ly69pn%2biz8abHxEcf45dc33B%2br2KCtfHKjbq6r%2bRneprPqdnw41vqUfauYWhnk7Xq7luX\u002FPDiKQOxK7qJgUjNVBg5I3GpkTeLAVWMNKzzgwpPQK9NNDPi4SxO%2bBnoCgUDw%2bL5A6HH3E64QXummMY%2bdlbOawHtCyEPC9N6eFC23rOv1Ib\u002FljyorH%2bwife0xZCQ53f3cJFHh%2boHaHvAxK7h\u002FrRoIBFw3GYoiSiJiI6Fhv8JDYsthDmQtmE1OOQWPomEd8GskGpi%2bbAslcKAuAcIQLpTkj%2b8gwKqs9sJnwn6QD1sQxK6sU4GnNe3%2bgZ2SR1S4EI0MrVMBc4JnwHHiUgUycY5C3t3BGtdtmpB3kTlPyOK8tYgo74EJwPjsVTpNUx1sgeAoutERnImWLBWkQ457P9l%2bEC7Fyr6rqGdVKnQk6YBUmcyH2xxkJdTtMw9TvtfRQndIwesbOIy3h2PE7pn%2bQTp%2bYNg7AmmAs\u002FsyCp%2bEEhuYC%2bW9e6U%2bg3vVRHiqx89Nk8a%2b%2bDa75%2bkb%2bswcNk6ukeHGKHXDEl%2bOsJb6c8ZAKToXxhbIKOqRgoyx\u002F\u002F26DC67MNvLjmX\u002FOWoAEWIQDHpvaY4WgslawrIGhGgoh4jq3VXK8sH6kk4jsOzRQ1ZDY4MiOIilgky8FxMShtD7AA5otCPCZBVGs22laDPqA9MAS4Cm8hW7rB1B66GkV29NHCepx6xRASBny2JP5TIroeA5x5l8zl4HCGDf8pNKiZ1jUYDdctM5hvhEWAH3I42pt87OCBy%2bM3gIFbnSTD0ZYpDAfSzBzxmXY\u002F59gxJh%2b1rNvLZXI6%2bCuK1G6UYdgDFoBDsdoNqWPAcbe2K2dOhtCULtjcQP2RjdeVXq8MO4l%2b1GQiUQ54Xclt6AD2OStQ6FbcH2KFGDpYnaJL6dGwf8Ds6ZalVUuu7cAAAAASUVORK5CYII=' \u002F%3e%3c\u002Fsvg%3e\" width=\"818\" alt=\"System diagram\" data-srcset=\"\u002Fassets\u002Fstatic\u002Fiot-testing.82a2fbd.101f743b8a410c5a65e1a292c125624b.png 480w, \u002Fassets\u002Fstatic\u002Fiot-testing.bda9032.101f743b8a410c5a65e1a292c125624b.png 818w\" data-sizes=\"(max-width: 818px) 100vw, 818px\" data-src=\"\u002Fassets\u002Fstatic\u002Fiot-testing.bda9032.101f743b8a410c5a65e1a292c125624b.png\"\u003E\u003Cnoscript\u003E\u003Cimg class=\"g-image g-image--lazy g-image--loaded\" src=\"\u002Fassets\u002Fstatic\u002Fiot-testing.bda9032.101f743b8a410c5a65e1a292c125624b.png\" width=\"818\" alt=\"System diagram\"\u003E\u003C\u002Fnoscript\u003E\u003C\u002Fp\u003E\n\u003Ch2 id=\"as-a-user-i-should-be-able-to\"\u003E\u003Ca href=\"#as-a-user-i-should-be-able-to\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EAs a user, I should be able to…\u003C\u002Fh2\u003E\n\u003Cp\u003EThe main function of the e2e testing is to ensure that the system is able to perform the actions that are required of it. Some examples of the kinds of test cases which were created are:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003ECreating a user account\u003C\u002Fli\u003E\n\u003Cli\u003EPerforming Wifi on-boarding of the IoT gateway\u003C\u002Fli\u003E\n\u003Cli\u003EThread on-boarding using QR scanning\u003C\u002Fli\u003E\n\u003Cli\u003ETraining the IR sensor with real IR input\u003C\u002Fli\u003E\n\u003Cli\u003EChecking that the IoT device sends data when requested\u003C\u002Fli\u003E\n\u003Cli\u003ESetting up schedules and other app functionality\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch2 id=\"appium-pytest-and-a-whole-bunch-of-usb-serial-adapters\"\u003E\u003Ca href=\"#appium-pytest-and-a-whole-bunch-of-usb-serial-adapters\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EAppium, PyTest and a whole bunch of USB serial adapters\u003C\u002Fh2\u003E\n\u003Cp\u003EDue to the need to be able to factory reset hardware during and at the end of the tests we had 2 options - simulate button presses with relays or some other switching method soldered on to the target boards, or we could use builds of the software which had serial enabled (Shipped versions never have serial enabled!). We opted for using serial cables because this allowed us to accelerate the testing by being able to send \u003Ccode\u003Ereset\u003C\u002Fcode\u003E commands to the target hardware and verify that this had happen. In other parts of the tests, serial output is used to assert correct output from system components to help debug when a larger component fails.\u003C\u002Fp\u003E\n\u003Cp\u003EIn an ideal world we of course would not have needed serial cables and we would have a mechanical means to physically actuate any user input. That’s not likely to happen for us soon due to the large time investment in making custom rigs for every device which we test.\u003C\u002Fp\u003E\n\u003Cp\u003EThe main system testing stack was built with:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003EAppium (1.6.5)\u003C\u002Fli\u003E\n\u003Cli\u003EPyTest (with extensive use of fixtures for code reuse)\u003C\u002Fli\u003E\n\u003Cli\u003EPyserial\u003C\u002Fli\u003E\n\u003Cli\u003EDocker (for running in CI)\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch2 id=\"appium\"\u003E\u003Ca href=\"#appium\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EAppium\u003C\u002Fh2\u003E\n\u003Cp\u003E“\u003Ca href=\"http:\u002F\u002Fappium.io\u002Fdocs\u002Fen\u002Fabout-appium\u002Fintro\u002F?lang=en\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EAppium is an open-source tool for automating native, mobile web, and hybrid applications on iOS, Android and Windows platforms\u003C\u002Fa\u003E”. Appium is cross-platform so the same test code can be applied to both the iOS and Android versions of the React-Native app which itself uses the same JavaScript code for both (mostly!).\u003C\u002Fp\u003E\n\u003Cp\u003EAppium abstracts the vendor-provided automation frameworks including Apple’s XCTest, Google’s UiAutomator, Google’s Instrumentation and Microsoft’s WinAppDriver are wrapped in a single API, known as the “WebDriver”, which is the same API used in Selenium, a popular tool for automated website testing.\u003C\u002Fp\u003E\n\u003Cp\u003EAppium uses a Client\u002FServer model, connected via the WebDriver API, where the client sends appropriate HTTP requests to the server in order to execute commands on the target device. The server will respond with the result of the command execution. This abstraction means that the client and tests can be written in any language with a HTTP client, clients are already available in many languages such as Python, Java, Perl, PHP and Ruby. We chose to use the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fappium\u002Fpython-client\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EPython client\u003C\u002Fa\u003E, matching the language of the IoT platform software. This has the added benefit that existing code such as PyTest fixtures can be implemented easily.\u003C\u002Fp\u003E\n\u003Ch2 id=\"writing-tests\"\u003E\u003Ca href=\"#writing-tests\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EWriting tests\u003C\u002Fh2\u003E\n\u003Cp\u003EWe based our test code around this \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fcasschin\u002Fappium-pytest\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EAppium example project\u003C\u002Fa\u003E, which uses the Python Appium client in combination with PyTest. The code consists of a \u003Ccode\u003Escreen.py\u003C\u002Fcode\u003E file which contains useful helper functions such as \u003Ccode\u003Eget_elements_by_type\u003C\u002Fcode\u003E which, when given a method of element identification (\u003Ccode\u003Expath\u003C\u002Fcode\u003E, \u003Ccode\u003Eaccessibility_id\u003C\u002Fcode\u003E, \u003Ccode\u003Eid\u003C\u002Fcode\u003E, \u003Ccode\u003Eclass_name\u003C\u002Fcode\u003E, \u003Ccode\u003Ename\u003C\u002Fcode\u003E, \u003Ccode\u003Eandroid\u003C\u002Fcode\u003E or \u003Ccode\u003Eios\u003C\u002Fcode\u003E) and corresponding value, returns the element you wish to interact with. A very helpful tool for identifying characteristics of the currently rendered DOM and it’s elements for Android is \u003Ccode\u003EUiAutomatorView\u003C\u002Fcode\u003E which comes with Android Studio. Each screen within the app has a Python class associated with it where all of the relevant element locators are defined, usually just the elements that a user can interact with e.g. buttons, scroll windows and text fields.\u003C\u002Fp\u003E\n\u003Cp\u003EAppium commands are built up in to a sequence of functions acting across multiple screens of the target app with one or more assert statement that tests whether the app has behaved as expected. The assert statement can be as simple as asserting that an element is visible on the screen or that the text within the elements is equal to an expected value. A simple example test is registering a new user and ensuring that you can login to the app using the newly registered account.\u003C\u002Fp\u003E\n\u003Cp\u003EOur longest and most complex test includes the whole user experience setting up the IoT system after unboxing and testing all of the major bits of product functionality. The setup process even involves scanning a QR code to identify the IoT Device to setup, therefore the camera on the Mobile Device is directed towards a print out of the relevant QR code. One piece of tested functionality is the ability to schedule times at which the AC power is turned on \u002F off with a defined configuration, for example every Monday at 12:30pm turn on the AC at 16°C, on \u003Ccode\u003ECool\u003C\u002Fcode\u003E mode with fan setting \u003Ccode\u003EHigh\u003C\u002Fcode\u003E, then turn off at 4:15pm. To test this an IR event is scheduled 2 minutes into the future from the time at which the new schedule is saved. The test then waits long enough to check if that action gets performed as expected. The IR Receiver is then sent a command to collect any IR data that it receives over a 5 second period. If the system is functioning correctly in all areas then the IoT Device should emit IR data at that time. An assert statement then checks whether the IR data received is correct, meaning that it would result in an real AC device being turned on with the desired configuration.\u003C\u002Fp\u003E\n\u003Ch2 id=\"challenges\"\u003E\u003Ca href=\"#challenges\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EChallenges\u003C\u002Fh2\u003E\n\u003Ch3 id=\"test-repeatability\"\u003E\u003Ca href=\"#test-repeatability\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ETest repeatability\u003C\u002Fh3\u003E\n\u003Cp\u003ENaturally, an essential property of any test is repeatability, this is being able to run the same test multiple times on the same system and having the same outcome. To achieve this it was ensured that the state of the whole system was the same at the start and end of each class of PyTest tests. When the IoT Gateway and Devices are connected during the setup process this leaves them in a state in which another user of the mobile application cannot communicate with them. Resetting the IoT hardware to factory settings was done using a serial cable connected to the test machine or over SSH, this happens within the teardown phase of PyTest fixtures which can be applied to any test that requires it. The state of the database is also manipulated using fixtures, for example populating the database in the setup phase with relevant sensor data to be shown on the app graphs or reverting changes in the tear-down phase such as deleting a new user that was registered during the test.\u003C\u002Fp\u003E\n\u003Ch3 id=\"time\"\u003E\u003Ca href=\"#time\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ETime\u003C\u002Fh3\u003E\n\u003Cp\u003EAppium tests are usually faster than it would take to perform the tests manually however if many tests are created, to give a high level of coverage, then the execution time of a full test run can reach into the hours. This means that a test run on every new commit is not practical, so instead tests are run overnight, this can sometimes hinder development flow. The time spent during test execution includes the time it takes to perform actions, particularly sending keys into text fields, and waiting for the app to render the element that Appium is waiting for which increases with the response time of the Database Server.\u003C\u002Fp\u003E\n\u003Ch3 id=\"platform-specifics\"\u003E\u003Ca href=\"#platform-specifics\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EPlatform specifics\u003C\u002Fh3\u003E\n\u003Cp\u003EDespite using React-Native in this case, there are many platform specific differences between iOS and android, for example in our React-Native app we use the native time pickers which have a very different appearance on the two platforms. This means that separate test code has to be used when interacting with these components. The Android time picker also happened to be very tricky to interact with via Appium as the movable minute hand of clock snaps to the nearest 5 minutes if the clock is tapped. A work around was to scroll from the nearest 5th minute to the desired minute, which rotates the minute hand during the scroll and stops without snapping.\u003C\u002Fp\u003E\n\u003Cp\u003EUnfortunately, there are a great many other examples of these differences.\u003C\u002Fp\u003E\n\u003Ch3 id=\"react-native\"\u003E\u003Ca href=\"#react-native\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EReact-Native\u003C\u002Fh3\u003E\n\u003Cp\u003EFacebook, who developed React-Native, use the \u003Ccode\u003EtestId\u003C\u002Fcode\u003E property of the rendered views in their internal testing however this is not available in the current version of Appium (v1.6.5). The \u003Ccode\u003EreasourceId\u003C\u002Fcode\u003E can also not be set via React-Native (v49.0). Hence at the moment a work around for uniquely identifying elements is to use the \u003Ccode\u003EaccessibilityLabel\u003C\u002Fcode\u003E which sets the \u003Ccode\u003Econtent-desc\u003C\u002Fcode\u003E property of the view. The disadvantage of using the \u003Ccode\u003Econtent-desc\u003C\u002Fcode\u003E property is that this is displayed to the user if they chose to do so from the accessibility settings, so the \u003Ccode\u003Econtent-desc\u003C\u002Fcode\u003E needs to be human readable and unique at least within each screen. At the time of putting together the E2E test system no accessibility labels were set in the app, so there was the tedious task of defining all of these for every element that was to be used in testing.\u003C\u002Fp\u003E\n\u003Ch3 id=\"brittleness\"\u003E\u003Ca href=\"#brittleness\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EBrittleness\u003C\u002Fh3\u003E\n\u003Cp\u003EDue to the fact that so many parts of the system are touched in every test, changes in any one of those components has the ability to break the tests, or require that more are created. Fixtures have helped us to mitigate many of the problems of this, since generally updating a fixture and a couple of tests is all that’s required.\u003C\u002Fp\u003E\n\u003Ch2 id=\"conclusion\"\u003E\u003Ca href=\"#conclusion\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EConclusion\u003C\u002Fh2\u003E\n\u003Cp\u003EE2E testing complete IoT systems has identified compatibility issues and bugs before releases that our unit tests did not catch, particularly between the app and the server where the software is changing most rapidly. More importantly we have been able to ensure that all app functionality is tested very regularly, rather than the risk that only new or changed features are tested (rather than their knock-on effects).\u003C\u002Fp\u003E\n\u003Cp\u003EAppium served as a very helpful, easy to use testing tool for automating user interaction with the IoT system, already saving precious days of manual testing time. The essentials of this test system should be able to port over to other similar IoT projects which use an Android or iOS app as it’s main user interface.\u003C\u002Fp\u003E\n","tags":[{"title":"IoT","path":"\u002Ftag\u002FIoT\u002F"},{"title":"Testing","path":"\u002Ftag\u002FTesting\u002F"},{"title":"Appium","path":"\u002Ftag\u002FAppium\u002F"},{"title":"Docker","path":"\u002Ftag\u002FDocker\u002F"},{"title":"React-Native","path":"\u002Ftag\u002FReact-Native\u002F"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.ac1117d7.js" defer></script><script src="/assets/js/page--src--templates--post-vue.2d35173e.js" defer></script>
  </body>
</html>
