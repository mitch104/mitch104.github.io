{"hash":"be4ce0c63ceb5cbc26b02c0c477ed144fd2f7de3","data":{"post":{"title":"AI assisted workflow for Django query optimizations","date":"August 3, 2025","content":"<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 841 596' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-21cf64648e150f10b1f707433b5a4193'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-21cf64648e150f10b1f707433b5a4193)' width='841' height='596' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAtAEADASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAgQAAQMFB//EADQQAAIBAwIDBQYEBwAAAAAAAAECAwAEERIhExQxBSJxkaEjQVFhktFSU2OBFTJDRGLw8f/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A8AtSsiYPIJpwMy5BNGHTc6OzdweoP3orZ7sxqGkuUjAAXTEWGP8AhrVpLgS9y6uyuNmNucn9qDBdJBAHZ23xHX1q1ZevD7O39xU7etXKk0yKs0l0yDcZgO1LvaMFHDSdj8DERRW%2bVIGE7OG34T8fGsblAQu9qMbex2z41kLac9IJT7v5D9qnLTn%2bhL9B%2b1EBoH4hU0Y31Cj5Wfb2Eu/TuHf0quBIoLNHIADvlTgf7tQNW93KY1jM0MaqMAOmc%2bQNbSXcgfRzdmQvRwhx4dKYVSLBOFdziQw7KbiLSNtxjOobbY60pO1/ChkkulI6d2dWO/yBzQXzshYlrm1wf0zgeAxQtfyxLlJrds42WPf1FL8/dn%2b4l6561Y7QvASRcygnqc0Gbzyu5YyOCTnutgftQ8WX82T6zQu7O7O5LMxySffQ0GnFk/Mk%2bs1YaRsDW5ycadROayq0JV1Kkgg7EUHW7PhCwZaG3kZgGUtPCMeIbJHpTM95b2sKxPZxktvlGgfx3Vdq59g8KwSl4FdxjBIUgeamn35QIGFqAc4OyfP/AA%2bVAnNfWZRuFZ6XxhdQjIHiAm9KNdsUK8K2APvEKg%2beK699dRxW5MFrCCcDvxo2B9I3%2bdc7%2bIycbicvZaumOXXHlQI1Kca%2bdmLG3s8n9AUq7anLEKMnoowPKgGoOo8alQdR40H/2Q==' /%3e%3c/svg%3e\" width=\"841\" alt=\"Copilot workflow\" data-srcset=\"/assets/static/copilot-screenshot.82a2fbd.34af4401cab333fbfbe74c40f515e559.jpeg 480w, /assets/static/copilot-screenshot.e9949b5.34af4401cab333fbfbe74c40f515e559.jpeg 841w\" data-sizes=\"(max-width: 841px) 100vw, 841px\" data-src=\"/assets/static/copilot-screenshot.e9949b5.34af4401cab333fbfbe74c40f515e559.jpeg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/copilot-screenshot.e9949b5.34af4401cab333fbfbe74c40f515e559.jpeg\" width=\"841\" alt=\"Copilot workflow\"></noscript></p>\n<h2 id=\"introduction\"><a href=\"#introduction\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Introduction</h2>\n<p>In this article, I share an experimental approach to optimizing Django queries using an AI-assisted workflow. By combining <a href=\"https://code.visualstudio.com/docs/copilot/overview\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">VSCode Copilot</a>, Postgres <a href=\"https://code.visualstudio.com/docs/copilot/chat/mcp-servers\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MCP server</a>, <a href=\"https://github.com/jazzband/django-silk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">django-silk</a> and <a href=\"https://playwright.dev/python/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Playwright</a>, I was able to automate parts of the query analysis and optimization process. The results were promising, though the workflow had some notable limitations.</p>\n<h2 id=\"problem\"><a href=\"#problem\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Problem</h2>\n<p>In a large Django application, I wanted to address inefficient queries, particularly N+1 problems, that could often be resolved with <a href=\"https://docs.djangoproject.com/en/5.2/ref/models/querysets/#select-related\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">select_related</a> or <a href=\"https://docs.djangoproject.com/en/5.2/ref/models/querysets/#prefetch-related\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">prefetch_related</a>. Given the size of the codebase, I explored whether an AI coding agent could help speed up the process.</p>\n<p>Two main obstacles emerged:</p>\n<ol>\n<li>The AI needed a way to measure the number of queries executed</li>\n<li>The AI needed a way to send authenticated requests to the application</li>\n</ol>\n<h2 id=\"solution\"><a href=\"#solution\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Solution</h2>\n<p><a href=\"https://github.com/jazzband/django-silk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Django-silk</a> records SQL queries in database tables whenever a webpage is requested. This makes it straightforward to spot N+1 issues through duplicate queries and to trace them back to the source code. Silk provides a web interface for manual analysis, but since the data is stored in Postgres, it can also be accessed programmatically.</p>\n<p>By installing and configuring a Postgres MCP server in VSCode, Copilot gained access to these tables. This enabled the AI to analyze query performance directly from my local database, solving the first challenge of query measurement.</p>\n<p>To configure a Postgres MCP server add the following to <code>~/.vscode/mcp.json</code> using your actual database url:</p>\n<pre><code class=\"language-json\">{\n    \"servers\": {\n        \"postgres\": {\n            \"command\": \"npx\",\n            \"args\": [\n                \"-y\",\n                \"@modelcontextprotocol/server-postgres\",\n                \"postgresql://user:pass@localhost:5432/mydb\"\n            ]\n        }\n    }\n}\n</code></pre>\n<p>Then open the command palette and run \"MCP: List servers\", then select \"postgres\", then select \"Start server\". If the connection to your database is successful the output should say \"Discovered 1 tools\".</p>\n<p>For the second challenge, I used <a href=\"https://playwright.dev/python/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Playwright</a> to automate browser interactions. The following script logs into the application and navigates to a specified page, allowing Copilot to trigger queries during the request/response cycle:</p>\n<pre><code class=\"language-python\"># request_page.py\n\nimport sys\n\nfrom playwright.sync_api import sync_playwright\n\ndef send_authenticated_request(url_path: str) -> None:\n    \"\"\"Navigate to the specified page with authentication.\"\"\"\n    base_url = \"&#x3C;http://localhost:8001>\"\n    full_url = f\"{base_url}{url_path}\"\n\n    with sync_playwright() as p:\n        browser = p.chromium.launch(headless=False)\n        page = browser.new_page()\n\n        page.goto(f\"{base_url}/login/\")\n        page.wait_for_selector('input[name=\"username\"]', timeout=10000)\n        page.fill('input[name=\"username\"]', \"mitch.harle\")\n        page.click('button[type=\"submit\"]')\n        page.fill('input[name=\"password\"]', \"*******\")\n        page.click('button[type=\"submit\"]')\n        page.wait_for_url(f\"{base_url}/\", timeout=10000)\n\n        page.goto(full_url)\n        page.wait_for_url(full_url, timeout=10000)\n\nif _name_ == \"_main_\":\n    send_authenticated_request(sys.argv[1])\n</code></pre>\n<p>The following prompt can then be used to start the process in Copilot:</p>\n<blockquote>\n<p>I am attempting to perform Django query optimizations across my application. When I ask you to optimize queries on the url <code>/abc/</code> you should call the following script: <code>python3 request_page.py /abc/</code></p>\n<p>If the script runs successfully please use the Postgres MCP server to query django-silk tables to measure the queries for this url. You should identify if there are any N+1 queries, this is usually identified by many duplicate queries. The 'SQLQuery' table has a field 'traceback' which will give you the code which executed the SQL query, use this to find where in the code query optimizations can be made. For now I am mostly focusing on fixing very inefficient queries, for example those that can be fixed with <code>select_related</code>/<code>prefetch_related</code>.</p>\n<p>You should attempt to fix the code, then request the url again, then measure the queries again. If your code changes has reduced the number of queries keep the change, if not rollback the change and try a different approach.</p>\n<p>Let's start with url <code>/abc/</code></p>\n</blockquote>\n<p>Copilot then performed the following iterative loop:</p>\n<ol>\n<li>Send an authenticated request to the target page</li>\n<li>Analyze query execution data from Django-Silk</li>\n<li>Modify the code to reduce queries</li>\n</ol>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 976 586' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-f0b37779e3b0420571bd81cbd6617a1c'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-f0b37779e3b0420571bd81cbd6617a1c)' width='976' height='586' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAmCAYAAAB0xJ2ZAAAACXBIWXMAABYlAAAWJQFJUiTwAAAMxElEQVR42t1ad3BU5xFXJhijDgKVUznpJCRAqJxOdzr1Uzm1k4R6F6CGqBJIIIFAYHo3hjEYJk7sIcEh/sMmCbYncWyHZEjBjmNjmyEODvJMnHEZUmzPpI2TX3b33TudhKRIIBgnf%2by8d9/73n777e5vv9195%2bIVkQxPnRkeoUmYl5SJQGsuggqsd0B5d/je/aFAIk12DubEpsEjJAmy73AzXHjzXvOTEVpdhNDKQgTQJP/MbARYiDInSTR3XroFfhlZ0GTlQGPJUa5EARaV3/Bvfi78idR5o%2bdrLMN8Aiw5jveV39lTk9E%2bj42rayiGhq4eWkUJLmz50KpCaHJy4B5ogjtpRyHTJMg%2bL9gEvwWZmKNLxQP%2bCXgwwEBXPWYGJGCWJhGeWjNmBSbKM9cgIx7UGOBGV1ca4zk8n68z/PQ03wCvULMyrjHYeRjkfb5ncgs2ihUnJ6OTrCQn7zestkgUyDxc5hkzRQHuQSbxBKGIyZH3/BS4hhoRZsxH745DSLY1IsZSgcWZZUgraabxApS3dCM2qwKa2Gyk0HNNbBYWppWibf0gajp6EWEugj63GjGZ5UgqrEdJ8xrkVrVDn1OFRelL5N282hXILFsucyKTbWhesxnzFmXAIzxpSvLyXM8wM7wXpkBXb1MgoMnNVawfoiiAByfNkIgVEG4qRNOqfnRv3Y/B/SfQv%2bsoqtt65NpKG03Mq4W1ugOPnDmLxpV9aO3ehs27H0b58i5s23ccgwdOoGf7QVS2rsemnUewcuNOrOh9CEX1K7Hz8En0DB7Elj3HsPvoY2jfsB2rNu1CQEwW3MNMU5JV9kZ7VL1%2bTkyaooAAwpUEhqlo007uuiT4LbYgu6IVxrw6pJcuk2tIghUGaw2yK9sQGJeDBLIyKyFjyTJk0Jz0kqXQGQvJ0tV2i1cj1JCP1OImeT%2b5qJHum%2bUd/s0elV66VOZllbfCO2LqxlK9gPHP8c4nPn1YAe53oABVAPewJLhqCdshBqJEzNImytgsvifyICXNCNQT3qLh4huDr/jHwcUvBjODKVbwuO9iGovFVzXxQsyHeTAvuQ9R7mfZefNVXXvKSlAVUDUNCnAWwHv%2bSFLHZlOccAs1CX4t5S1ItTUhLqtSvCAqpRhaQ554gym/HonWWpQ0rZE4whudHZkqcWY0bx7zulsPmC4FjCWI828JlOQdBbWdEhO2Eua7BvYJjlf37caytQM4cvIJdBLuB/Y%2bgnVb9oqC2Du8I1LGtfQdbf5eKWAswfjKwUa9D9bnUgQvRlJBAxalLUEDBUMLRfakgnqYiKLTy%2bgUaBC8axPyxGu8o1KUwKwz392m74cCWDhVQN443/NZK8/DkyViS5wgy86ik8M7Kg2uNPYA4XkmjfNpMjM4QSzPc3nTs6NTJUFz5v2lVYCzIvh4WdhViYjlpSP4ekemCK69gvTwoCDoRQHQOyiBiK60aW875h0nDL0bVEgpdlGeJDF3ckzffwWQ5TjV1O9poPwi1yG4F23MU8sZXCJ8y%2blo3HMcvo%2bdhc%2bR0/Bp3wTvxCJ4U%2bATHsJr2Jt0DTbMNWQ40te7UsK9hIAqsLaiUHL3OYvTFPyS5XnjXgYros89jegbN%2bD/yR/g9%2bktzPnjx/B85zp8nrwA98pVSnLDLm/ny/xYUF1TsSMWfOk8QM2w2NqcVYaUFSiptfqc08/4NDS99AIO3/wIgz97B7VXrsHnzd9A98a72PTmTez61U2suPgqQlv74U7xwOEJdr5czQUXTwMU7lUewJtki4c3F4/MD8j6XMyYetvwzaH3sff6Z6j/%2bS1sfeYaYk88h7qzP8Hp3/4Z665/iq6XP0THhSuYTTmDJ8PBKR44oJB4l1C4Vwpgplxl%2bZotioAqr3BKhHQG2E7lYOul6zB%2b%2bwMk7R3C2hOvo7DzJDoGn0LthSHEP3oTlp030f3sVUSs6oVbQLwERWdo%2bcSRghkKd3MqTKcCnF2f%2bwji%2bg4XVQKZW3AS/K1WVL0UgzWPX0Tm9t%2bhdff76Dt2Gc3rD6Kl/2tYf%2boqqgZuYOXA%2b2h58gfQ738EXgvTadOm29YJzGMo5N85FKZLAc6uz%2be1uL6zQJwCB%2buxeOkG2M6dRO0votB4uAN1XUfQuOVR7D/3Pbz3ycd46doQ1hx/HlUbn0BZz2lYj5%2bE5cx5FJw6C02ajYQ1jpBLoEClLJfxzlCYtCKmVQHMjN4LqyHXT7aMrCg5BQ6JQ96xJ1H%2brWOouzQfGy/0YtfFfTj2/Dfw4mu/xK2//RNDt/6Ep165jMMXX8bB88%2bh5uTjMG7dh7pnXkRMazdmBcRJHHFAgYosbmuxwp03fl8VMML16V1tecEYLklHnzYWMd2HYNw9gMZXwrHnh/vxo6G38f0330J13yl8%2bPlnePHX76J562lcHvo9zl16A5WHzyC6vRfxO85REtRCfPWOYDjitKFcI6Q0f%2bRpMxkl3K0CHBrnVHURu34JnfPJY57RnjoTwnKWIHFDNhquBGDvM0dx%2bcZHuPDaW2jf93XygL/j5avvovPAE3ju7SEcffYKCjY/jIjqHvimNlBGmUs8ksaUQ/INqun9M7Klw3NfPMB5EbYC5%2bl%2bqVkO1x/pjgp5hJgRmJGAtBMR6D6/Gd99%2bxou3fwAH/71H/j8i3/jL1/8C%2b99%2bjm%2b8/p7GDz/UyQ09MHXWC4b9wwfH%2bOscK414nbUITDfOvmgOB0QYAac8HDGN97Ccgo4jkjlRNAWmmEdWIa%2bp87g8R%2b/ghfeuoZnX72KA0%2b/gNrtxxFhbcLsBRniOf/NrXmcN7CopwqRK8ocLb174gFjaZ%2b1zhCYqFT1jDA7jkOuCN2CzXClis8tMgE%2bhnQEphbAz5hPv1OpSqTxEMOw1SOGFTheA0Ytt3kPXDrfZQxQNMjtK67FmRm3tZSOTMpwZ8be5ODFee7w2HADRKWRQisBTMYpOfKk9925OOK0l57LuPrOBFZXr1w%2bc1eYZfXSjVx7dOfae1QQHVMBjGNmOG9RJkITCzAnKhUBMdlKb45reLKOK90zSbuKnvssSJca342EcZU%2boElqerWPpzwzjfIQ83D7fZJteGfLstLn0rrzk0vgvzgLWpJ1RmC8yKDKyvdu3H/gsRBljGWZ0AM8Q814gOryjLJWtPXuRmHDWrRs2IWC%2bjUooPvCxnUob92I7KoVNKcN9au3Ij6nBuFJNhTRs2TbUhGqZOl65NWtxpLlPTAXNWNRRvntEAob7hZNteXGm2IDrew/ILKJrLS%2bmdZnmXntTCq3ozMrYCpshK25m%2bTuhSGvXt4V7x0PAvywmF6oaNuIpd0PoaylF539%2b7F8/U7UrtwCS0UHGtcOEm2TsYXpZbJJVhT/rmzvw7rBo2jt2SVC8G9WFiuWeattMo4dfulZjh49K2RcGpXosHWD4q2oWbEZzV3bsYzk7Ni0V%2bTq7NuPFlq7ed12NK7ZJldWyuqBQyK7KCByPAVQNGe39iUIsCuzlkMS8hCst0pff05UmnR4o1JKkVq6XDo7DBEWKrVkOSJTShBM8zWxOfIez01b0iLfDNydznJOmvR7GyR6cyLDZzmfJmMR1xazF6aOyDE87fGC3Z/JNzoTWkO%2bKEWVmeXle62hQOTgMZ7H8JkwBnDU5knuEgiNEpkZ2/wZihWh9PWUro1vtEV%2b81zGWUhCvr0DnIiZQQnER7Geh25k6crtMj5BeIM%2b%2bnRJayei2/MLOxQI0/I9wo5z9jKOPTM08cpnM/kWET8cn1QjTHQM8gY4eEQQrhlLebWrkFPdiQZyJ4YG45pJMF%2b8VOZYKtpR1dGHJnLBrMoOmZ9P4wwjDpIeTtaXhIbcmr1NdW/O7acCAeVDjEm8z0LrsVyRFHt4zdJlG8TlOWbx%2bvkUI3gsLrt6giBodVIANy9Ii/rcWsF/W%2b8eYVTRtgl1qwYkmLBbV6/ol9%2b2pi5Ud/QTBvfJGNOSlh5UEfZZsMD4XFHobXnC/Kn19kfP482EGQsl4PLatuYurNpyUGJRZfsmgej6HcdQ07lZYlNuzUrZl3LUjvo0xrm0dF25qIgcXiyEcMVRPjqjQizJm%2bErx4K5CzNEgAizTfDnH5OFIIIIux5/EVbnqIFvWtrZo4hdm08gs61ZZODYxTCVWEXxieMDf0Dlr9J8P8ITCZ5htTZ4L0iBC2dQ3GXhH%2bKa7KY0Qc5wrYIfdlM%2bz/nKjDzs3wJdCXtugkWT4zmPq3M87XHgXhBnlq52%2bdR4wEqRtXVmJT6F2kkarYpx3QKM8ocJDsby/wB2B67luarjJgPDQChqHJro2Rhz2avuFU1FRplPRuYaRjU4G8hFLW7mJqQLLuSvMv%2bnxI0bbqcJ1MMUaLo4Nx2lrJ1Is//jpJbxzifLfwBV6QlXoYCA2wAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"976\" alt=\"Copilot workflow\" data-srcset=\"/assets/static/query-optimization-cycle.82a2fbd.cc57fe203efaa62861dd88c0cb6acee3.png 480w, /assets/static/query-optimization-cycle.f67bb29.cc57fe203efaa62861dd88c0cb6acee3.png 976w\" data-sizes=\"(max-width: 976px) 100vw, 976px\" data-src=\"/assets/static/query-optimization-cycle.f67bb29.cc57fe203efaa62861dd88c0cb6acee3.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/query-optimization-cycle.f67bb29.cc57fe203efaa62861dd88c0cb6acee3.png\" width=\"976\" alt=\"Copilot workflow\"></noscript></p>\n<p>This feedback loop with an explicit goal of reducing queries allowed it identify when it's changes have made a positive or negative impact. With some human oversight, this process successfully identified and resolved several inefficient queries.</p>\n<h2 id=\"limitations\"><a href=\"#limitations\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Limitations</h2>\n<p>The limitations of this approach included:</p>\n<ol>\n<li>After each code change, the Django server needed to restart, sometimes causing requests to be sent prematurely. The Playwright script could be improved to handle this more reliably.</li>\n<li>Each script execution required manual confirmation, I could not find a way to auto-approve these actions.</li>\n<li>The script only supported GET requests. Optimizing queries behind POST requests or JavaScript interactions would require custom Playwright actions.</li>\n<li>As always the code suggestions by Copilot were not perfect and needed human reviewing/editing.</li>\n<li>At times, Copilot forgot how to call scripts and needed reminders.</li>\n</ol>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusion</h2>\n<p>This experiment demonstrated that AI coding agents can meaningfully assist in query optimization workflows. While not fully autonomous, the combination of Copilot, Django-Silk, Postgres MCP server, and Playwright provided a practical, partially automated solution for identifying and resolving inefficient queries.</p>\n<p>Future improvements could include adding more robust request handling, scripting additional guardrails, and automating approval steps to streamline the process further. Despite its limitations, setting up this workflow was quick and delivered tangible benefits, highlighting the evolving capabilities of AI-assisted development tools.</p>\n","tags":[{"title":"Copilot","path":"/tag/Copilot/"},{"title":"Django","path":"/tag/Django/"},{"title":"Django-silk","path":"/tag/Django-silk/"},{"title":"Playwright","path":"/tag/Playwright/"},{"title":"AI","path":"/tag/AI/"},{"title":"LLMs","path":"/tag/LLMs/"}]}},"context":{}}